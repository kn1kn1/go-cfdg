<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Context Free Art Playground</title>

  <link rel="shortcut icon" href="image/favicon.ico" type="image/vnd.microsoft.icon" />
  <link rel="icon" href="image/favicon.ico" type="image/vnd.microsoft.icon" />

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css">

  <script src="js/codemirror.js"></script>
  <link rel="stylesheet" href="css/codemirror.css">
  <style>
  .CodeMirror { height: auto; border: 1px solid #ddd; }
  .CodeMirror-scroll { max-height: 500px; }
  .CodeMirror pre { padding-left: 7px; line-height: 1.25; }
  </style>
  <script>
  $(document).ready(function() {
    var count = 0;
    var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
      lineNumbers: true
    });

    $('#renderButton').click(function() {
      $('#output').empty();
      render();
    })

    function render() {
      var code = editor.getValue();
      var encoded = encodeURIComponent(code);
      var checkUrl = 'check?code=' + encoded + '&count=' + count;
      $.ajax(checkUrl)
        .done(function(data) {
          if (data && data["Error"]) {
            var err = $('<p>',{id:'err'}).css({padding:'2px',backgroundColor:'yellow'});
            err.append(document.createTextNode(data["Message"]));
            $('#output').append(err);
            return;
          }

          // var renderUrl = 'https://cfdg.herokuapp.com/render?code=' + encoded + '&count=' + count;
          var renderUrl = 'render?code=' + encoded + '&count=' + count;

          count++;
          $('#output').append($('<img>',{id:'theImg',src:renderUrl}));
        })
        .fail(function(jqXHR) {
          var err = $('<p>',{id:'err'}).css({padding:'2px',backgroundColor:'yellow'});
          err.append(document.createTextNode("url: " + checkUrl + "\n"
            + "status: " + jqXHR.status + ", statusText: " + jqXHR.statusText));
          $('#output').append(err);
          return;
        });
    }

    render();
  });
  </script>
</head>

<body style="padding-top: 10px">
  <div class="container">
    <h1>Context Free Art Playground</h1>
  </div>
  <div class="container">
    <div class="row" style="margin: 5px">
      <div class="col-md-6">
        <textarea id="code" name="code">/*
 * http://www.contextfreeart.org/gallery/view.php?id=1647
 */
startshape main

background {sat .3 h 200}

rule main {
  CLOVER {b .2}
  main {z -1 s 0.8 x 4 r 100}
}

rule CLOVER {
  CIRCLE {}
  CLOVER {x 1.0 s 0.99 r 90 b 0.01}
}</textarea>
      <br>
      <input type="button" value="Render" id="renderButton">
      </div>
      <div id="output"class="col-md-6"></div>
    </div>
    <div class="row" style="margin: 5px">
      <center><a href="https://github.com/kn1kn1/go-cfdg">Project Home at GitHub</a></center>
    <div>
  </div>
</body>
</html>
